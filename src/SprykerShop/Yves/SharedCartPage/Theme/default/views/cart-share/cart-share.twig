{% extends template('page-layout-customer', 'CustomerPage') %}

{% define data = {
    cartName: _view.cart.name | default,
    form: _view.sharedCartForm,
    title: 'shared_cart.form.share_cart.title' | trans({cart_name: _view.cart.name | default}),
    activePage: 'multiCart'
} %}

{% block breadcrumbs %}
    {% include molecule('breadcrumb') with {
        data: {
            steps: [{
                url: 'customer/overview',
                label: 'customer.profile' | trans
            },{
                url: 'multi-cart',
                label: 'shared_cart.share.breadcrumbs.shopping_carts' | trans
            },{
                url: 'cart',
                label: data.cartName
            },{
                label: 'shared_cart.share.breadcrumbs.share' | trans
            }]
        }
    } only %}
{% endblock %}

{% set shared = [] %}
{% set unShared = [] %}

{% for shareDetail in data.form.shareDetails %}
    {% if shareDetail.vars.value.quotePermissionGroup is null %}
        {% set unShared = unShared | merge([shareDetail]) %}
    {% else %}
        {% set shared = shared | merge([shareDetail]) %}
    {% endif %}
{% endfor %}

{% block customerContent %}
    {{ form_start(data.form) }}
        <div class="box" data-qa="component share-cart-table">
            <h3 class="spacing-left">{{ 'shared_cart.share.form.users' | trans }}</h3>

            {% include molecule('user-share-list', 'SharedCartPage') with {
                data: {
                    shareDetailsForm: data.form,
                    shared: shared
                }
            } only %}

            {% include molecule('user-share-list', 'SharedCartPage') with {
                data: {
                    shareDetailsForm: data.form,
                    shared: unShared
                }
            } only %}

            <div class="box">
                <button type="submit" class="button button--success float-right">
                    {{ 'shared_cart.form.save_button' | trans }}
                </button>
            </div>
        </div>
    {{ form_end(data.form) }}
{% endblock %}
